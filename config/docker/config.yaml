mixed-port: 7890
ipv6: true
allow-lan: true
bind-address: "*"
mode: rule
log-level: warning
unified-delay: true
tcp-concurrent: true
profile:
  store-selected: true
  store-fake-ip: true
find-process-mode: strict
global-client-fingerprint: chrome

dns:
  enable: true
  cache-algorithm: arc
  ipv6: true
  ipv6-timeout: 300
  listen: 0.0.0.0:1053
  use-hosts: true
  prefer-h3: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - 'localhost.ptlogin2.qq.com'
    - 'dns.msftncsi.com'
    - 'www.msftncsi.com'
    - 'www.msftconnecttest.com'
  nameserver:
    - quic://dns.adguard.com:784  
    - https://1.1.1.1/dns-query
    - https://1.0.0.1/dns-query
    - https://mozilla.cloudflare-dns.com/dns-query
    - dhcp://auto# 
  default-nameserver: 
    - tls://223.5.5.5:853
    - https://223.5.5.5/dns-query 
    - tcp://119.29.29.29
    - tcp://223.6.6.6 
  nameserver-policy:
    "geosite:cn,private":
      - https://223.5.5.5/dns-query
      - https://doh.pub/dns-query
      - https://doh.360.cn/dns-query
      - tls://223.5.5.5
      - tls://dot.pub
    "rule-set:direct,private,apple,icloud":
      - https://223.5.5.5/dns-query
      - https://doh.pub/dns-query
      - https://doh.360.cn/dns-query
      - tls://223.5.5.5
      - tls://dot.pub 
  fallback:
    - tls://8.8.4.4:853
    - tcp://1.1.1.1
    - https://1.1.1.1/dns-query
    - https://1.0.0.1/dns-query
    - tls://1dot1dot1dot1.cloudflare-dns.com
  fallback-filter:    
    geoip: true 
    geoip-code: CN
    geosite:      
      - cn
    ipcidr:
      - 240.0.0.0/4


sniffer:
  enable: true
  force-dns-mapping: false
  parse-pure-ip: false          
  override-destination: false 
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443]
  force-domain:
    - google.com
    - +.v2ex.com
  skip-domain:
    - Mijia Cloud
    - +.apple.com
  sniffing:
    - tls
    - http
  port-whitelist:
    - "80"
    - "443"

tun:
  enable: true
  stack: system
  dns-hijack:
    - "any:53"
    - tcp://any:53
  auto-route: true
  auto-detect-interface: true
  mtu: 9000
  strict-route: true
  inet4-route-address: 
    - 0.0.0.0/1
    - 128.0.0.0/1
  inet6-route-address: 
    - "::/1"
    - "8000::/1"

proxies:
  - name: 台湾谷歌[联通直连]
    type: vless
    server: 34.80.173.121
    port: 443
    uuid: 58a45875-6a18-4a91-9556-2d00e0e3cc94
    udp: true
    tls: true
    flow: xtls-rprx-vision
    servername: itunes.apple.com
    reality-opts:
      public-key: 5os-UBV1w11xtkpPJA9QZRL4q49BNwoyjDB4yJRYoko
    client-fingerprint: chrome

  - name: 香港谷歌[联通直连]
    type: vless
    server: 2600:1900:41a0:20b:0:d:0:0
    port: 443
    uuid: 58a45875-6a18-4a91-9556-2d00e0e3cc94
    udp: true
    tls: true
    flow: xtls-rprx-vision
    servername: itunes.apple.com
    reality-opts:
      public-key: 5os-UBV1w11xtkpPJA9QZRL4q49BNwoyjDB4yJRYoko
    client-fingerprint: chrome

  - name: 日本甲骨文[移动直连]
    type: vless
    server: 138.2.40.110
    port: 443
    uuid: 3f7e2e88-a6b2-486d-85f3-e1efdcab8ecb
    udp: true
    tls: true
    flow: xtls-rprx-vision
    servername: itunes.apple.com
    reality-opts:
      public-key: TSNtcEdzYv6PI3awG-fwVtl9XufVNigDEVDqpK0htjg
    client-fingerprint: chrome

  - name: 韩国甲骨文[三网直连]
    type: vless
    server: 146.56.159.99
    port: 443
    uuid: 269b1822-9140-49fb-a59e-0b039a4a83f9
    udp: true
    tls: true
    flow: xtls-rprx-vision
    servername: itunes.apple.com
    reality-opts:
      public-key: cRKw0wE5VPrgxdvpoIReC1Ot4vrwJTcxBTAmRpD8Ezw
      short-id: fe60318a2ee38f77
    client-fingerprint: chrome

  - name: RN美国[备用]
    type: vless
    server: 107.173.156.139
    port: 443
    uuid: af583733-1915-4bec-b0ab-ba1f82488862
    udp: true
    tls: true
    flow: xtls-rprx-vision
    servername: itunes.apple.com
    reality-opts:
      public-key: 907EIwpMSetGcfQx7cG8drq2AWPGCXY6HYwtCVwpIRQ
      short-id: 4c24b8176d0b351b
    client-fingerprint: chrome

  - name: dns-out
    type: dns

proxy-groups:
  - name: 自动选择
    type: url-test
    url: https://www.apple.com
    interval: 300
    tolerance: 150
    expected-status: 204
    proxies:
      - 台湾谷歌[联通直连]
      - 香港谷歌[联通直连]
      - 日本甲骨文[移动直连]
      - 韩国甲骨文[三网直连]
      - RN美国[备用]

  - name: 手动选择
    type: select
    proxies:
      - 自动选择
      - DIRECT
      - 台湾谷歌[联通直连]
      - 香港谷歌[联通直连]
      - 日本甲骨文[移动直连]
      - 韩国甲骨文[三网直连]
      - RN美国[备用]


rule-providers:
  去广告:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/reject.yaml
    interval: 86400

  ai:
    type: http
    behavior: domain
    format: text
    path: ./rules/ai.list
    url: "https://raw.githubusercontent.com/DustinWin/ruleset_geodata/clash-ruleset/ai.list"
    interval: 86400

  NoPcdn:
    type: http
    behavior: domain
    format: text
    path: ./rules/NoPcdn.list
    url: "https://ruleset.skk.moe/List/non_ip/reject-no-drop.conf"
    interval: 86400

  NoOperatorHijack:
    type: http
    behavior: domain
    format: text
    path: ./rules/NoOperatorHijack.list
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Hijacking/Hijacking.list"
    interval: 86400

  icloud:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
    path: ./ruleset/icloud.yaml
    interval: 86400

  apple:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
    path: ./ruleset/apple.yaml
    interval: 86400

  google:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt"
    path: ./ruleset/google.yaml
    interval: 86400

  netflix:
    type: http
    behavior: domain
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/netflix.list"
    path: ./ruleset/google.yaml
    interval: 86400

  YouTube:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTube/YouTube.list"
    path: ./ruleset/YouTube.list
    interval: 86400

  proxy:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.yaml
    interval: 86400

  direct:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400

  private:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./ruleset/private.yaml
    interval: 86400

  gfw:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt"
    path: ./ruleset/gfw.yaml
    interval: 86400

  tld-not-cn:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt"
    path: ./ruleset/tld-not-cn.yaml
    interval: 86400

  telegramcidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: ./ruleset/telegramcidr.yaml
    interval: 86400

  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

  lancidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./ruleset/lancidr.yaml
    interval: 86400

  applications:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./ruleset/applications.yaml
    interval: 86400

  collection: 
    type: http
    behavior: classical
    format: yaml
    path: ./ruleset/collection.yaml
    url: "https://gist.githubusercontent.com/cnfree8964/0864fd1d2e88936a095fb40d74ce4993/raw/collection.yaml"

rules:
  - RULE-SET,lancidr,DIRECT
  - RULE-SET,private,DIRECT
  - GEOSITE,private,DIRECT
  - IP-CIDR,127.0.0.1/32,REJECT,no-resolve
  - IP-CIDR,198.18.0.1/16,REJECT,no-resolve
  - IP-CIDR,28.0.0.1/8,REJECT,no-resolve
  - IP-CIDR6,::1/128,REJECT,no-resolve 
  - AND,((NETWORK,TCP),(DST-PORT,5228-5230)),DIRECT
  - AND,((NETWORK,TCP),(DST-PORT,5228-5230),(OR,((DOMAIN-KEYWORD,google)))),DIRECT
  - AND,((NETWORK,UDP),(DST-PORT,123)),DIRECT
  - DST-PORT,123/136/137-139,DIRECT,udp


  - RULE-SET,applications,DIRECT
  - RULE-SET,netflix,手动选择
  - DOMAIN,clash.razord.top,DIRECT
  - DOMAIN,yacd.haishan.me,DIRECT
  - RULE-SET,去广告,REJECT
  - RULE-SET,NoPcdn,REJECT
  - RULE-SET,NoOperatorHijack,REJECT
  - DOMAIN-KEYWORD,szbdyd,REJECT

  - DOMAIN-KEYWORD,gemini,手动选择
  - DOMAIN-KEYWORD,builtwith,DIRECT
  - DOMAIN-KEYWORD,velo,DIRECT
  - DOMAIN-KEYWORD,xda,DIRECT
  - DOMAIN-KEYWORD,daxiaamu,DIRECT
  - DOMAIN-KEYWORD,nodeseek,DIRECT
  - DOMAIN-KEYWORD,wechat,DIRECT
  - DOMAIN-KEYWORD,macked,手动选择
  - DOMAIN-KEYWORD,sourceforge,手动选择
  - DOMAIN-KEYWORD,porn,自动选择
  - DOMAIN-KEYWORD,tanhuazu,手动选择
  - DOMAIN-KEYWORD,pikpak,手动选择
  - DOMAIN-KEYWORD,v2rayssr,手动选择
  - DOMAIN-SUFFIX,xn--ngstr-lra8j.com,手动选择
  - DOMAIN-SUFFIX,googleapis.cn,手动选择

  - RULE-SET,icloud,DIRECT
  - RULE-SET,apple,DIRECT
  - RULE-SET,ai,韩国甲骨文[三网直连]
  - RULE-SET,google,手动选择
  - RULE-SET,YouTube,手动选择
  - RULE-SET,proxy,手动选择
  - RULE-SET,direct,DIRECT
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,telegramcidr,手动选择
  - RULE-SET,collection,DIRECT,no-resolve
  - GEOIP,LAN,DIRECT,no-resolve
  - GEOIP,CN,DIRECT,no-resolve
  - MATCH,手动选择
